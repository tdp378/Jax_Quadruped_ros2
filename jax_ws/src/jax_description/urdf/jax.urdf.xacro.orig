<?xml version="1.0"?>
<robot name="jax" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- ================= WORLD ================= -->

  <link name="world"/>

  <joint name="world_to_base" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0.23"/>
  </joint>

  <!-- ================= MATERIALS ================= -->

  <material name="black"><color rgba="0.1 0.1 0.1 1"/></material>
  <material name="white"><color rgba="1 1 1 1"/></material>
  <material name="debug"><color rgba="1 0 0 0.4"/></material>

  <!-- ================= BASE ================= -->

  <link name="base_link">
    <visual>
      <geometry>
        <mesh filename="package://jax_description/meshes/base_link.stl"
         scale=".001 .001 .001"/>
      </geometry>
      <material name="white"/>
    </visual>

    <collision>
      <geometry>
        <box size="0.26 0.14 0.06"/>
      </geometry>
    </collision>

    <inertial>
      <mass value="3.0"/>
      <inertia ixx="0.02" iyy="0.04" izz="0.05"
               ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>


<!-- IMU LINK -->
<link name="imu_link">
  <inertial>
    <mass value="0.001"/>
    <origin xyz="0 0 0"/>
    <inertia
      ixx="1e-6" ixy="0" ixz="0"
      iyy="1e-6" iyz="0"
      izz="1e-6"/>
  </inertial>
</link>
  
<joint name="base_to_imu" type="fixed">
  <parent link="base_link"/>
  <child link="imu_link"/>
  <origin xyz="0 0 0.03" rpy="0 0 0"/>
</joint>

  <!-- FRONT RIGHT LEG -->

  <link name="front_right_hip">
    <visual>
      <origin xyz="0 -0.035 0.01" rpy="0 0 0"/> 
      <geometry>
        <mesh filename="package://jax_description/meshes/right_hip.stl"
          scale=".001 .001 .001"/>
      </geometry>
      <material name="black"/>
    </visual>

     <collision>
      <origin xyz="0 -0.02 0"/>
     <geometry>
      <sphere radius="0.025"/>
     </geometry>
     </collision>

    <inertial>
      <mass value="0.15"/>
      <origin xyz="0 -0.02 0"/>
      <inertia
      ixx="0.0002" ixy="0" ixz="0"
      iyy="0.0002" iyz="0"
      izz="0.0002"/>
    </inertial>

  </link>


<joint name="front_right_hip_joint" type="revolute">
  <parent link="base_link"/>
  <child link="front_right_hip"/>
  <origin xyz="0.11 -0.06 -0.01"/>
  <axis xyz="1 0 0"/>
  <limit lower="-0.6" upper="0.6" effort="2.0" velocity="1.5"/>
  <dynamics damping="0.5" friction="0.0"/>
</joint>


<link name="front_right_thigh">
  <visual>
    <origin xyz="0 -.038 0" rpy="0 0 0"/>
    <geometry>
          <mesh filename="package://jax_description/meshes/right_thigh.stl"
          scale=".001 .001 .001"/>
    </geometry>
    <material name="white"/>
  </visual>

  <collision>
    <origin xyz="0 -.039 -0.065"/>
    <geometry>
      <cylinder radius="0.012" length="0.15"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.35"/>
    <origin xyz="0 -0.39 -0.065"/>
    <inertia
      ixx="0.001" ixy="0" ixz="0"
      iyy="0.001" iyz="0"
      izz="0.0003"/>
  </inertial>

</link>


  <joint name="front_right_thigh_joint" type="revolute">
    <parent link="front_right_hip"/>
    <child link="front_right_thigh"/>
    <origin xyz="0 0 0.01"/>
    <axis xyz="0 -1 0"/>
    <limit lower="-1.2" upper="1.2" effort="3.0" velocity="2.0"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>

  <link name="front_right_calf">
    <visual>
      <origin xyz="0 -0.048 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://jax_description/meshes/right_calf.stl"
          scale=".001 .001 .001"/>
      </geometry>
      <material name="black"/>
    </visual> 

    <collision>
      <origin xyz="0.05 -0.043 -0.045" rpy="0 -0.85 0"/>
      <geometry>
        <cylinder radius="0.012" length="0.13"/>
      </geometry>
    </collision>

    <inertial>
      <mass value="0.25"/>
      <origin xyz="0.05 -0.043 -0.045" rpy="0 -0.85 0"/>
      <inertia
      ixx="0.0007" ixy="0" ixz="0"
      iyy="0.0007" iyz="0"
      izz="0.0002"/>
    </inertial>


  </link>

  <joint name="front_right_knee_joint" type="revolute">
  <parent link="front_right_thigh"/>
  <child link="front_right_calf"/>
  <origin xyz="0 0 -0.13"/>
  <axis xyz="0 -1 0"/>
  <limit lower="0" upper="1.4" effort="4.0" velocity="2.5"/>
  <dynamics damping="0.9" friction="0.0"/>
</joint>

<link name="front_right_foot">

  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/foot.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black">
    </material>
  </visual>

  <collision>
    <origin xyz="0 0 0.005"/>
    <geometry>
      <sphere radius="0.010"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.08"/>
    <origin xyz="0 0 0.005"/>
    <inertia
      ixx="0.00005" ixy="0" ixz="0"
      iyy="0.00005" iyz="0"
      izz="0.00005"/>
  </inertial>



</link>

<joint name="front_right_ankle_joint" type="fixed">
  <parent link="front_right_calf"/>
  <child link="front_right_foot"/>
  <origin xyz="0.095 -0.044 -0.1" rpy="0 0 0"/>
</joint>

<gazebo reference="front_right_foot">
  <mu1>1.2</mu1>
  <mu2>1.2</mu2>
  <kp>100000</kp>
  <kd>100</kd>
</gazebo>


<!-- FRONT LEFT LEG -->

<link name="front_left_hip">
  <visual>
    <origin xyz="0 0.035 0.01"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_hip.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 0.02 0"/>
    <geometry>
      <sphere radius="0.025"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.15"/>
    <origin xyz="0 0.02 0"/>
    <inertia ixx="0.0002" ixy="0" ixz="0"
             iyy="0.0002" iyz="0"
             izz="0.0002"/>
  </inertial>
</link>

<joint name="front_left_hip_joint" type="revolute">
  <parent link="base_link"/>
  <child link="front_left_hip"/>
  <origin xyz="0.11 0.06 -0.01"/>
  <axis xyz="1 0 0"/>
  <limit lower="-0.6" upper="0.6" effort="2.0" velocity="1.5"/>
  <dynamics damping="0.5" friction="0.0"/>
</joint>

<link name="front_left_thigh">
  <visual>
    <origin xyz="0 0.038 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_thigh.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="white"/>
  </visual>

  <collision>
    <origin xyz="0 0.039 -0.065"/>
    <geometry>
      <cylinder radius="0.012" length="0.15"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.35"/>
    <origin xyz="0 0.039 -0.065"/>
    <inertia ixx="0.001" ixy="0" ixz="0"
             iyy="0.001" iyz="0"
             izz="0.0003"/>
  </inertial>
</link>

<joint name="front_left_thigh_joint" type="revolute">
  <parent link="front_left_hip"/>
  <child link="front_left_thigh"/>
  <origin xyz="0 0 0.01"/>
  <axis xyz="0 -1 0"/>
  <limit lower="-1.2" upper="1.2" effort="3.0" velocity="2.0"/>
  <dynamics damping="0.7" friction="0.0"/>
</joint>

<link name="front_left_calf">
  <visual>
    <origin xyz="0 0.048 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_calf.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0.05 0.043 -0.045" rpy="0 -0.85 0"/>
    <geometry>
      <cylinder radius="0.012" length="0.13"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.25"/>
    <origin xyz="0.05 0.043 -0.045" rpy="0 -0.85 0"/>
    <inertia ixx="0.0007" ixy="0" ixz="0"
             iyy="0.0007" iyz="0"
             izz="0.0002"/>
  </inertial>
</link>

<joint name="front_left_knee_joint" type="revolute">
  <parent link="front_left_thigh"/>
  <child link="front_left_calf"/>
  <origin xyz="0 0 -0.13"/>
  <axis xyz="0 -1 0"/>
  <limit lower="0" upper="1.4" effort="4.0" velocity="2.5"/>
  <dynamics damping="0.9" friction="0.0"/>
</joint>

<link name="front_left_foot">
  <visual>
    <geometry>
      <mesh filename="package://jax_description/meshes/foot.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 0 0.005"/>
    <geometry>
      <sphere radius="0.010"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.08"/>
    <origin xyz="0 0 0.005"/>
    <inertia ixx="0.00005" ixy="0" ixz="0"
             iyy="0.00005" iyz="0"
             izz="0.00005"/>
  </inertial>
</link>

<joint name="front_left_ankle_joint" type="fixed">
  <parent link="front_left_calf"/>
  <child link="front_left_foot"/>
  <origin xyz="0.095 0.044 -0.1" rpy="0 0 0"/>
</joint>

<gazebo reference="front_left_foot">
  <mu1>1.2</mu1>
  <mu2>1.2</mu2>
  <kp>100000</kp>
  <kd>100</kd>
</gazebo>

<!-- REAR RIGHT LEG -->

<link name="rear_right_hip">
  <visual>
    <origin xyz="0 -0.035 0.01"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/right_hip.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 -0.02 0"/>
    <geometry>
      <sphere radius="0.025"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.15"/>
    <origin xyz="0 -0.02 0"/>
    <inertia ixx="0.0002" ixy="0" ixz="0"
             iyy="0.0002" iyz="0"
             izz="0.0002"/>
  </inertial>
</link>

<joint name="rear_right_hip_joint" type="revolute">
  <parent link="base_link"/>
  <child link="rear_right_hip"/>
  <origin xyz="-0.11 -0.06 -0.01"/>
  <axis xyz="1 0 0"/>
  <limit lower="-0.6" upper="0.6" effort="2.0" velocity="1.5"/>
  <dynamics damping="0.5" friction="0.0"/>
</joint>

<link name="rear_right_thigh">
  <visual>
    <origin xyz="0 -0.038 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/right_thigh.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="white"/>
  </visual>

  <collision>
    <origin xyz="0 -0.039 -0.065"/>
    <geometry>
      <cylinder radius="0.012" length="0.15"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.35"/>
    <origin xyz="0 -0.039 -0.065"/>
    <inertia ixx="0.001" ixy="0" ixz="0"
             iyy="0.001" iyz="0"
             izz="0.0003"/>
  </inertial>
</link>

<joint name="rear_right_thigh_joint" type="revolute">
  <parent link="rear_right_hip"/>
  <child link="rear_right_thigh"/>
  <origin xyz="0 0 0.01"/>
  <axis xyz="0 -1 0"/>
  <limit lower="-1.2" upper="1.2" effort="3.0" velocity="2.0"/>
  <dynamics damping="0.7" friction="0.0"/>
</joint>

<link name="rear_right_calf">
  <visual>
    <origin xyz="0 -0.048 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/right_calf.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0.05 -0.043 -0.045" rpy="0 -0.85 0"/>
    <geometry>
      <cylinder radius="0.012" length="0.13"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.25"/>
    <origin xyz="0.05 -0.043 -0.045" rpy="0 -0.85 0"/>
    <inertia ixx="0.0007" ixy="0" ixz="0"
             iyy="0.0007" iyz="0"
             izz="0.0002"/>
  </inertial>
</link>

<joint name="rear_right_knee_joint" type="revolute">
  <parent link="rear_right_thigh"/>
  <child link="rear_right_calf"/>
  <origin xyz="0 0 -0.13"/>
  <axis xyz="0 -1 0"/>
  <limit lower="0" upper="1.4" effort="4.0" velocity="2.5"/>
  <dynamics damping="0.9" friction="0.0"/>
</joint>

<link name="rear_right_foot">
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/foot.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 0 0.005"/>
    <geometry>
      <sphere radius="0.010"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.08"/>
    <origin xyz="0 0 0.005"/>
    <inertia
      ixx="0.00005" ixy="0" ixz="0"
      iyy="0.00005" iyz="0"
      izz="0.00005"/>
  </inertial>
</link>

<joint name="rear_right_ankle_joint" type="fixed">
  <parent link="rear_right_calf"/>
  <child link="rear_right_foot"/>
  <origin xyz="0.095 -0.044 -0.1" rpy="0 0 0"/>
</joint>

<gazebo reference="rear_right_foot">
  <mu1>1.2</mu1>
  <mu2>1.2</mu2>
  <kp>100000</kp>
  <kd>100</kd>
</gazebo>


<!-- REAR LEFT LEG -->

<link name="rear_left_hip">
  <visual>
    <origin xyz="0 0.035 0.01"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_hip.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 0.02 0"/>
    <geometry>
      <sphere radius="0.025"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.15"/>
    <origin xyz="0 0.02 0"/>
    <inertia
      ixx="0.0002" ixy="0" ixz="0"
      iyy="0.0002" iyz="0"
      izz="0.0002"/>
  </inertial>
</link>

<joint name="rear_left_hip_joint" type="revolute">
  <parent link="base_link"/>
  <child link="rear_left_hip"/>
  <origin xyz="-0.11 0.06 -0.01"/>
  <axis xyz="1 0 0"/>
  <limit lower="-0.6" upper="0.6" effort="2.0" velocity="1.5"/>
  <dynamics damping="0.5" friction="0.0"/>
</joint>

<link name="rear_left_thigh">
  <visual>
    <origin xyz="0 0.038 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_thigh.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="white"/>
  </visual>

  <collision>
    <origin xyz="0 0.039 -0.065"/>
    <geometry>
      <cylinder radius="0.012" length="0.15"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.35"/>
    <origin xyz="0 0.039 -0.065"/>
    <inertia
      ixx="0.001" ixy="0" ixz="0"
      iyy="0.001" iyz="0"
      izz="0.0003"/>
  </inertial>
</link>

<joint name="rear_left_thigh_joint" type="revolute">
  <parent link="rear_left_hip"/>
  <child link="rear_left_thigh"/>
  <origin xyz="0 0 0.01"/>
  <axis xyz="0 -1 0"/>
  <limit lower="-1.2" upper="1.2" effort="3.0" velocity="2.0"/>
  <dynamics damping="0.7" friction="0.0"/>
</joint>

<link name="rear_left_calf">
  <visual>
    <origin xyz="0 0.048 0"/>
    <geometry>
      <mesh filename="package://jax_description/meshes/left_calf.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0.05 0.043 -0.045" rpy="0 -0.85 0"/>
    <geometry>
      <cylinder radius="0.012" length="0.13"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.25"/>
    <origin xyz="0.05 0.043 -0.045" rpy="0 -0.85 0"/>
    <inertia
      ixx="0.0007" ixy="0" ixz="0"
      iyy="0.0007" iyz="0"
      izz="0.0002"/>
  </inertial>
</link>

<joint name="rear_left_knee_joint" type="revolute">
  <parent link="rear_left_thigh"/>
  <child link="rear_left_calf"/>
  <origin xyz="0 0 -0.13"/>
  <axis xyz="0 -1 0"/>
  <limit lower="0" upper="1.4" effort="4.0" velocity="2.5"/>
  <dynamics damping="0.9" friction="0.0"/>
</joint>

<link name="rear_left_foot">
  <visual>
    <geometry>
      <mesh filename="package://jax_description/meshes/foot.stl"
            scale=".001 .001 .001"/>
    </geometry>
    <material name="black"/>
  </visual>

  <collision>
    <origin xyz="0 0 0.005"/>
    <geometry>
      <sphere radius="0.010"/>
    </geometry>
  </collision>

  <inertial>
    <mass value="0.08"/>
    <origin xyz="0 0 0.005"/>
    <inertia
      ixx="0.00005" ixy="0" ixz="0"
      iyy="0.00005" iyz="0"
      izz="0.00005"/>
  </inertial>
</link>

<joint name="rear_left_ankle_joint" type="fixed">
  <parent link="rear_left_calf"/>
  <child link="rear_left_foot"/>
  <origin xyz="0.095 0.044 -0.1" rpy="0 0 0"/>
</joint>

<gazebo reference="rear_left_foot">
  <mu1>1.2</mu1>
  <mu2>1.2</mu2>
  <kp>100000</kp>
  <kd>100</kd>
</gazebo>

 <!-- ========================================================= -->
  <!-- ================= ROS2 CONTROL ========================== -->
  <!-- ========================================================= -->

  <ros2_control name="GazeboSystem" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>

    <!-- Front Right -->
    <joint name="front_right_hip_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="front_right_thigh_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="front_right_knee_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <!-- Front Left -->
    <joint name="front_left_hip_joint"/>
    <joint name="front_left_thigh_joint"/>
    <joint name="front_left_knee_joint"/>

    <!-- Rear Right -->
    <joint name="rear_right_hip_joint"/>
    <joint name="rear_right_thigh_joint"/>
    <joint name="rear_right_knee_joint"/>

    <!-- Rear Left -->
    <joint name="rear_left_hip_joint"/>
    <joint name="rear_left_thigh_joint"/>
    <joint name="rear_left_knee_joint"/>
  </ros2_control>

  <!-- ================= TRANSMISSIONS ================= -->

  <xacro:macro name="simple_transmission" params="joint">
    <transmission name="${joint}_trans">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${joint}">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="${joint}_motor">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>

  <!-- Apply to all actuated joints -->
  <xacro:simple_transmission joint="front_right_hip_joint"/>
  <xacro:simple_transmission joint="front_right_thigh_joint"/>
  <xacro:simple_transmission joint="front_right_knee_joint"/>

  <xacro:simple_transmission joint="front_left_hip_joint"/>
  <xacro:simple_transmission joint="front_left_thigh_joint"/>
  <xacro:simple_transmission joint="front_left_knee_joint"/>

  <xacro:simple_transmission joint="rear_right_hip_joint"/>
  <xacro:simple_transmission joint="rear_right_thigh_joint"/>
  <xacro:simple_transmission joint="rear_right_knee_joint"/>

  <xacro:simple_transmission joint="rear_left_hip_joint"/>
  <xacro:simple_transmission joint="rear_left_thigh_joint"/>
  <xacro:simple_transmission joint="rear_left_knee_joint"/>

  <!-- ================= GAZEBO PLUGIN ================= -->

  <gazebo>
    <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so"/>
  </gazebo>

<gazebo reference="imu_link">
  <sensor name="imu_sensor" type="imu">
    <always_on>true</always_on>
    <update_rate>400</update_rate>
    <visualize>false</visualize>

    <imu>
      <angular_velocity>
        <noise type="gaussian">
          <mean>0.0</mean>
          <stddev>0.0002</stddev>
        </noise>
      </angular_velocity>

      <linear_acceleration>
        <noise type="gaussian">
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </linear_acceleration>
    </imu>
  </sensor>
</gazebo>


</robot>
